<project default="dist">
    
    <property file="build.properties" />
    
    <condition property="isMac">
        <os family="mac" />
    </condition>

    <condition property="isWindows">
        <os family="windows" />
    </condition>

    <condition property="isLinux">
        <and>
            <os family="unix"/>
            <not><os family="mac"/></not>
        </and>
    </condition>	
	
    <target name="distMac" if="isMac">
	    <echo message="Creating macOS distribution of Mirador" />
        
        <!-- build app bundle with packr -->
        <java jar="packr.jar" fork="true">
            <arg line="config/macos.json" />
        </java>

        <!-- packr does not allow to set the version string, doing it manually -->
        <copy file="macos/Info.plist.tmpl" tofile="macos/Mirador.app/Contents/Info.plist" overwrite="true"/>
        <replace file="macos/Mirador.app/Contents/Info.plist" token="@@mirador.version@@" value="${mirador.version}"/>

        <!-- signing app bundle -->
        <exec executable="codesign">
            <arg line="--verbose --force --sign ${certificate.application} macos/Mirador.app" />
        </exec>

        <!-- create flat installation package -->
        <exec executable="pkgbuild">
            <arg line="--root macos --component-plist macos/component.plist --install-location /Applications --sign ${certificate.installer} --scripts macos/scripts macos/Mirador-${mirador.version}.pkg" />
        </exec>

    </target>
	
	<target name="distWindows" if="isWindows">
	    <echo message="Creating Windows distribution of Mirador" />
	</target>
	
	<target name="distLinux" if="isLinux">
        <echo message="Creating Linux distribution of Mirador" />
	</target>	
    
	<target name="dist" depends="distMac, distWindows, distLinux">
    </target>
	
</project>